{"ast":null,"code":"import produce from'immer';import{ActionType}from'../action-types';var initialState={loading:false,error:null,order:[],data:{}};var reducer=produce(function(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case ActionType.SAVE_CELLS_ERROR:state.error=action.payload;return state;case ActionType.FETCH_CELLS:state.loading=true;state.error=null;return state;case ActionType.FETCH_CELLS_COMPLETE:state.order=action.payload.map(function(cell){return cell.id;});state.data=action.payload.reduce(function(acc,cell){acc[cell.id]=cell;return acc;},{});return state;case ActionType.FETCH_CELLS_ERROR:state.loading=false;state.error=action.payload;return state;case ActionType.UPDATE_CELL:var _action$payload=action.payload,id=_action$payload.id,content=_action$payload.content;state.data[id].content=content;return state;case ActionType.DELETE_CELL:delete state.data[action.payload];state.order=state.order.filter(function(id){return id!==action.payload;});return state;case ActionType.MOVE_CELL:var direction=action.payload.direction;var index=state.order.findIndex(function(id){return id===action.payload.id;});var targetIndex=direction==='up'?index-1:index+1;if(targetIndex<0||targetIndex>state.order.length-1){return state;}state.order[index]=state.order[targetIndex];state.order[targetIndex]=action.payload.id;return state;case ActionType.INSERT_CELL_AFTER:{var cell={content:'',type:action.payload.type,id:randomId()};state.data[cell.id]=cell;var _index=state.order.findIndex(function(id){return id===action.payload.id;});if(_index<0){state.order.unshift(cell.id);}else{state.order.splice(_index+1,0,cell.id);}return state;}default:return state;}},initialState);var randomId=function randomId(){return Math.random().toString(36).substr(2,5);};export default reducer;","map":{"version":3,"sources":["/home/utoker/Projects/utcode/packages/local-client/src/state/reducers/cellsReducer.ts"],"names":["produce","ActionType","initialState","loading","error","order","data","reducer","state","action","type","SAVE_CELLS_ERROR","payload","FETCH_CELLS","FETCH_CELLS_COMPLETE","map","cell","id","reduce","acc","FETCH_CELLS_ERROR","UPDATE_CELL","content","DELETE_CELL","filter","MOVE_CELL","direction","index","findIndex","targetIndex","length","INSERT_CELL_AFTER","randomId","unshift","splice","Math","random","toString","substr"],"mappings":"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","sourcesContent":["import produce from 'immer';\nimport { ActionType } from '../action-types';\nimport { Action } from '../actions';\nimport { Cell } from '../cell';\n\ninterface CellsState {\n  loading: boolean;\n  error: string | null;\n  order: string[];\n  data: {\n    [key: string]: Cell;\n  };\n}\n\nconst initialState: CellsState = {\n  loading: false,\n  error: null,\n  order: [],\n  data: {},\n};\n\nconst reducer = produce((state: CellsState = initialState, action: Action) => {\n  switch (action.type) {\n    case ActionType.SAVE_CELLS_ERROR:\n      state.error = action.payload;\n      return state;\n    case ActionType.FETCH_CELLS:\n      state.loading = true;\n      state.error = null;\n      return state;\n    case ActionType.FETCH_CELLS_COMPLETE:\n      state.order = action.payload.map((cell) => cell.id);\n      state.data = action.payload.reduce((acc, cell) => {\n        acc[cell.id] = cell;\n        return acc;\n      }, {} as CellsState['data']);\n      return state;\n    case ActionType.FETCH_CELLS_ERROR:\n      state.loading = false;\n      state.error = action.payload;\n      return state;\n    case ActionType.UPDATE_CELL:\n      const { id, content } = action.payload;\n      state.data[id].content = content;\n      return state;\n    case ActionType.DELETE_CELL:\n      delete state.data[action.payload];\n      state.order = state.order.filter((id) => id !== action.payload);\n      return state;\n    case ActionType.MOVE_CELL:\n      const { direction } = action.payload;\n      const index = state.order.findIndex((id) => id === action.payload.id);\n      const targetIndex = direction === 'up' ? index - 1 : index + 1;\n      if (targetIndex < 0 || targetIndex > state.order.length - 1) {\n        return state;\n      }\n      state.order[index] = state.order[targetIndex];\n      state.order[targetIndex] = action.payload.id;\n      return state;\n    case ActionType.INSERT_CELL_AFTER: {\n      const cell: Cell = {\n        content: '',\n        type: action.payload.type,\n        id: randomId(),\n      };\n\n      state.data[cell.id] = cell;\n\n      const index = state.order.findIndex((id) => id === action.payload.id);\n\n      if (index < 0) {\n        state.order.unshift(cell.id);\n      } else {\n        state.order.splice(index + 1, 0, cell.id);\n      }\n      return state;\n    }\n    default:\n      return state;\n  }\n}, initialState);\n\nconst randomId = () => {\n  return Math.random().toString(36).substr(2, 5);\n};\n\nexport default reducer;\n"]},"metadata":{},"sourceType":"module"}